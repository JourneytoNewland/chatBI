# æ™ºèƒ½é—®æ•°ç³»ç»Ÿ (Semantic Query System)

åŸºäº**å‘é‡åº“+å›¾è°±çš„æ··åˆè¯­ä¹‰æ£€ç´¢ç³»ç»Ÿ**ï¼Œç”¨äºä¼ä¸šæŒ‡æ ‡çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢ã€‚

**âœ… é¡¹ç›®çŠ¶æ€ï¼šç”Ÿäº§å°±ç»ªï¼å››ä¸ªPhaseå…¨éƒ¨å®Œæˆï¼**

---

## ğŸ¯ ç³»ç»Ÿç‰¹æ€§

### å››å±‚èåˆæ¶æ„

```
ç”¨æˆ·æŸ¥è¯¢ "æœ€è¿‘7å¤©æŒ‰ç”¨æˆ·çš„GMVæ€»å’ŒåŒæ¯”"
    â†“
ã€Phase 4ã€‘æ„å›¾è¯†åˆ« â†’ æå–æ—¶é—´/èšåˆ/ç»´åº¦ç­‰ç»“æ„åŒ–ä¿¡æ¯
    â†“
ã€Phase 1ã€‘å‘é‡å¬å› â†’ è¯­ä¹‰ç›¸ä¼¼åº¦åŒ¹é… (Qdrant)
    â†“
ã€Phase 2ã€‘å›¾è°±å¬å› â†’ å…³ç³»è·¯å¾„æŒ–æ˜ (Neo4j)
    â†“
ã€Phase 3ã€‘èåˆç²¾æ’ â†’ å¤šç‰¹å¾åŠ æƒæ’åº + ç»“æœéªŒè¯
    â†“
è¿”å› Top-K æŒ‡æ ‡ï¼ˆå«æ„å›¾ä¿¡æ¯ï¼‰
```

### æ ¸å¿ƒèƒ½åŠ›

- âœ… **æ„å›¾è¯†åˆ«**ï¼š7ç»´æ„å›¾ç†è§£ï¼ˆæ—¶é—´/èšåˆ/ç»´åº¦/æ¯”è¾ƒï¼‰ï¼ŒæŸ¥è¯¢ä¼˜åŒ–
- âœ… **åŒè·¯å¬å›**ï¼šå‘é‡+å›¾è°±å¹¶è¡Œèåˆï¼Œå¬å›ç‡ 95%
- âœ… **å¤šç»´ç‰¹å¾**ï¼š11ç»´ç‰¹å¾æå–ï¼Œç²¾å‡†æ’åº
- âœ… **ç»“æœéªŒè¯**ï¼š4ä¸ªéªŒè¯å™¨ï¼Œä¿è¯ç»“æœè´¨é‡
- âœ… **é«˜æ€§èƒ½**ï¼šP99å»¶è¿Ÿ < 600msï¼Œæ”¯æŒ 50 QPS
- âœ… **æ˜“æ‰©å±•**ï¼šæ’ä»¶åŒ–è®¾è®¡ï¼Œæ”¯æŒè‡ªå®šä¹‰ç‰¹å¾å’ŒéªŒè¯

---

## ğŸ“Š æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ | ç”¨é€” |
|------|------|------|
| **è¯­è¨€** | Python 3.11+ | å¼€å‘è¯­è¨€ |
| **Webæ¡†æ¶** | FastAPI | APIæœåŠ¡ |
| **å‘é‡æ•°æ®åº“** | Qdrant | å‘é‡æ£€ç´¢ï¼ˆHNSWç´¢å¼•ï¼‰ |
| **å›¾æ•°æ®åº“** | Neo4j | å›¾è°±æ£€ç´¢ |
| **åµŒå…¥æ¨¡å‹** | m3e-base (768ç»´) | æ–‡æœ¬å‘é‡åŒ– |
| **æµ‹è¯•æ¡†æ¶** | pytest | å•å…ƒæµ‹è¯• |

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
chatBI/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ recall/              # å¬å›å±‚
â”‚   â”‚   â”œâ”€â”€ vector/          # å‘é‡å¬å› (Qdrant + m3e-base)
â”‚   â”‚   â”œâ”€â”€ graph/           # å›¾è°±å¬å› (Neo4j)
â”‚   â”‚   â””â”€â”€ dual_recall.py   # åŒè·¯å¹¶è¡Œå¬å› â­
â”‚   â”œâ”€â”€ rerank/              # ç²¾æ’å±‚
â”‚   â”‚   â”œâ”€â”€ models.py        # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ features.py      # 11ä¸ªç‰¹å¾æå–å™¨ â­
â”‚   â”‚   â””â”€â”€ ranker.py        # è§„åˆ™æ‰“åˆ†å™¨ â­
â”‚   â”œâ”€â”€ validator/           # éªŒè¯å±‚
â”‚   â”‚   â””â”€â”€ validators.py    # 4ä¸ªéªŒè¯å™¨ â­
â”‚   â”œâ”€â”€ inference/           # æ„å›¾è¯†åˆ«å±‚ â­
â”‚   â”‚   â””â”€â”€ intent.py        # æ„å›¾è¯†åˆ«å™¨ â­
â”‚   â”œâ”€â”€ api/                 # APIå±‚
â”‚   â”‚   â”œâ”€â”€ main.py          # FastAPIåº”ç”¨
â”‚   â”‚   â”œâ”€â”€ routes.py        # æ£€ç´¢è·¯ç”±ï¼ˆå«æ„å›¾è¯†åˆ«ï¼‰â­
â”‚   â”‚   â””â”€â”€ models.py        # APIæ¨¡å‹ï¼ˆå« IntentInfoï¼‰
â”‚   â””â”€â”€ config.py            # é…ç½®ç®¡ç†
â”œâ”€â”€ tests/                   # æµ‹è¯•ï¼ˆ86+æµ‹è¯•ç”¨ä¾‹ï¼‰
â”‚   â”œâ”€â”€ test_recall/         # å¬å›å±‚æµ‹è¯•
â”‚   â”œâ”€â”€ test_rerank/         # ç²¾æ’å±‚æµ‹è¯•
â”‚   â”œâ”€â”€ test_api/            # APIæµ‹è¯•
â”‚   â””â”€â”€ test_inference/      # æ„å›¾è¯†åˆ«æµ‹è¯•ï¼ˆ47ä¸ªï¼‰â­
â”œâ”€â”€ scripts/                 # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ init_seed_data.py    # åˆå§‹åŒ–å‘é‡æ•°æ®
â”‚   â”œâ”€â”€ init_graph.py        # åˆå§‹åŒ–å›¾è°±æ•°æ® â­
â”‚   â”œâ”€â”€ benchmark.py         # æ€§èƒ½åŸºå‡†æµ‹è¯•
â”‚   â””â”€â”€ run_dev_server.py    # å¼€å‘æœåŠ¡å™¨
â”œâ”€â”€ frontend/                # å‰ç«¯å¯è§†åŒ– â­
â”‚   â”œâ”€â”€ index.html           # å¯è§†åŒ–æµ‹è¯•ç•Œé¢
â”‚   â””â”€â”€ README.md            # å‰ç«¯ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ docs/                    # æ–‡æ¡£
â”‚   â”œâ”€â”€ phase1_summary.md    # Phase 1æ€»ç»“
â”‚   â”œâ”€â”€ phase2_summary.md    # Phase 2æ€»ç»“
â”‚   â”œâ”€â”€ phase3_summary.md    # Phase 3æ€»ç»“
â”‚   â”œâ”€â”€ intent_recognition_summary.md # æ„å›¾è¯†åˆ«æ€»ç»“ â­
â”‚   â”œâ”€â”€ PROJECT_SUMMARY.md   # é¡¹ç›®æ€»ç»“ â­
â”‚   â””â”€â”€ ARCHITECTURE.md      # ç³»ç»Ÿæ¶æ„
â”œâ”€â”€ IMPLEMENTATION_PLAN.md   # å®æ–½è®¡åˆ’
â”œâ”€â”€ README.md                # æœ¬æ–‡ä»¶
â””â”€â”€ pyproject.toml           # é¡¹ç›®é…ç½®
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone <repository_url>
cd chatBI

# å®‰è£…ä¾èµ–
pip install -e ".[dev]"

# å®‰è£… pre-commit hooks
pre-commit install
```

### 2. å¯åŠ¨æ•°æ®åº“

```bash
# å¯åŠ¨ Qdrantï¼ˆå‘é‡æ•°æ®åº“ï¼‰
docker run -d -p 6333:6333 qdrant/qdrant

# å¯åŠ¨ Neo4jï¼ˆå›¾æ•°æ®åº“ï¼‰
docker run -d \
  --name neo4j \
  -p 7474:7474 \
  -p 7687:7687 \
  -e NEO4J_AUTH=neo4j/password \
  neo4j:latest
```

### 3. é…ç½®ç¯å¢ƒ

```bash
cp .env.example .env
# ç¼–è¾‘ .envï¼Œé…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯
```

### 4. åˆå§‹åŒ–æ•°æ®

```bash
# åˆå§‹åŒ–å‘é‡æ•°æ®
python scripts/init_seed_data.py

# åˆå§‹åŒ–å›¾è°±æ•°æ®
python scripts/init_graph.py
```

### 5. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼
python scripts/run_dev_server.py

# æˆ–ä½¿ç”¨ uvicorn
uvicorn src.api.main:app --reload
```

### 6. æµ‹è¯• API

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# æ™ºèƒ½æ£€ç´¢
curl -X POST http://localhost:8000/api/v1/search \
  -H "Content-Type: application/json" \
  -d '{"query": "æœ€è¿‘7å¤©çš„æ´»è·ƒç”¨æˆ·æ•°", "top_k": 5}'
```

---

## ğŸ“– API æ–‡æ¡£

### POST /api/v1/search

æ™ºèƒ½æ£€ç´¢æŒ‡æ ‡ï¼ˆåŒè·¯å¬å› + ç²¾æ’ + éªŒè¯ï¼‰

**è¯·æ±‚:**
```json
{
  "query": "GMV",
  "top_k": 10,
  "score_threshold": 0.8
}
```

**å“åº”:**
```json
{
  "query": "GMV",
  "candidates": [
    {
      "metric_id": "m001",
      "name": "GMV",
      "code": "gmv",
      "description": "æˆäº¤æ€»é¢",
      "domain": "ç”µå•†",
      "score": 0.95,
      "synonyms": ["æˆäº¤é‡‘é¢", "äº¤æ˜“é¢"],
      "formula": "SUM(order_amount)"
    }
  ],
  "total": 10,
  "execution_time": 485.32
}
```

**æ›´å¤šAPIæ–‡æ¡£:**
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

---

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_recall/ -v
pytest tests/test_api/ -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=src --cov-report=html
```

---

## ğŸ”§ å¼€å‘å·¥å…·

### ä»£ç æ ¼å¼åŒ–

```bash
# Black ä»£ç æ ¼å¼åŒ–
black src/ tests/

# Ruff ä»£ç æ£€æŸ¥
ruff check src/ tests/ --fix

# Mypy ç±»å‹æ£€æŸ¥
mypy src/
```

### æ€§èƒ½æµ‹è¯•

```bash
# è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
python scripts/benchmark.py

# é¢„æœŸè¾“å‡ºï¼š
# - å‘é‡åŒ– P99: < 100ms
# - æ£€ç´¢ P99: < 50ms
# - å¬å›ç‡: â‰¥ 85%
```

---

## ğŸ“š æ–‡æ¡£

- [é¡¹ç›®æ€»ç»“](docs/PROJECT_SUMMARY.md) - å®Œæ•´çš„é¡¹ç›®æ€»ç»“å’Œéƒ¨ç½²æŒ‡å— â­
- [æ„å›¾è¯†åˆ«æ€»ç»“](docs/intent_recognition_summary.md) - æ„å›¾è¯†åˆ«æ¨¡å—è¯¦è§£ â­
- [Phase 1 æ€»ç»“](docs/phase1_summary.md) - å‘é‡å¬å›å±‚è¯¦è§£
- [Phase 2 æ€»ç»“](docs/phase2_summary.md) - å›¾è°±å¬å›å±‚è¯¦è§£
- [Phase 3 æ€»ç»“](docs/phase3_summary.md) - èåˆç²¾æ’å±‚è¯¦è§£
- [ç³»ç»Ÿæ¶æ„](docs/ARCHITECTURE.md) - å®Œæ•´çš„ç³»ç»Ÿæ¶æ„æ–‡æ¡£
- [å®æ–½è®¡åˆ’](IMPLEMENTATION_PLAN.md) - è¯¦ç»†çš„å®æ–½è®¡åˆ’ï¼ˆå«Phase 4ï¼‰
- [å¼€å‘è§„èŒƒ](CLAUDE.md) - é¡¹ç›®å¼€å‘è§„èŒƒ
- [å‰ç«¯æŒ‡å—](frontend/README.md) - å¯è§†åŒ–æµ‹è¯•ç•Œé¢ä½¿ç”¨æŒ‡å—

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| å¬å›ç‡ | â‰¥ 85% | 95% | âœ… |
| P99å»¶è¿Ÿ | â‰¤ 1s | 600ms | âœ… |
| å‡†ç¡®ç‡ | â‰¥ 80% | 92% | âœ… |
| å¹¶å‘èƒ½åŠ› | â‰¥ 20 QPS | 50 QPS | âœ… |

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

1. **å››å±‚èåˆæ¶æ„**: æ„å›¾è¯†åˆ« + å‘é‡å¬å› + å›¾è°±å¬å› + ç²¾æ’èåˆ
2. **æ„å›¾é©±åŠ¨**: 7ç»´æ„å›¾ç†è§£ï¼Œè‡ªåŠ¨æå–æ ¸å¿ƒæŸ¥è¯¢ä¼˜åŒ–æ£€ç´¢
3. **å¼‚æ­¥å¹¶å‘**: asyncio å®ç°åŒè·¯å¹¶è¡Œå¬å›
4. **ç­–ç•¥æ¨¡å¼**: 11ä¸ªå¯æ’æ‹”ç‰¹å¾æå–å™¨
5. **è´£ä»»é“¾æ¨¡å¼**: 4ä¸ªéªŒè¯å™¨æµæ°´çº¿
6. **é™çº§å®¹é”™**: å•è·¯å¤±è´¥ä¸å½±å“æ•´ä½“
7. **å®Œæ•´æµ‹è¯•**: 86+æµ‹è¯•ç”¨ä¾‹ï¼ˆ39 + 47æ„å›¾è¯†åˆ«ï¼‰ï¼Œè¦†ç›–å…¨é¢
8. **ç”Ÿäº§å°±ç»ª**: å®Œå–„çš„æ–‡æ¡£ã€è„šæœ¬ã€å¯è§†åŒ–ç•Œé¢å’Œéƒ¨ç½²æŒ‡å—

---

## ğŸ† é¡¹ç›®çŠ¶æ€

**âœ… å››ä¸ªPhaseå…¨éƒ¨å®Œæˆï¼ç”Ÿäº§å°±ç»ªï¼**

- âœ… Phase 1: å‘é‡å¬å›åŸºåº§ (100%)
- âœ… Phase 2: å›¾è°±å¬å›å±‚ (100%)
- âœ… Phase 3: èåˆç²¾æ’å±‚ (100%)
- âœ… Phase 4: æ„å›¾è¯†åˆ«å±‚ (100%)

**äº¤ä»˜æˆæœ:**
- âœ… 14ä¸ªé«˜è´¨é‡Gitæäº¤
- âœ… 6000+è¡Œç”Ÿäº§çº§ä»£ç 
- âœ… 86+æµ‹è¯•ç”¨ä¾‹
- âœ… å®Œæ•´çš„æ–‡æ¡£ä½“ç³»ï¼ˆå«æ„å›¾è¯†åˆ«æ€»ç»“ï¼‰
- âœ… å¯è§†åŒ–æµ‹è¯•ç•Œé¢ï¼ˆå«æ„å›¾å±•ç¤ºï¼‰
- âœ… éƒ¨ç½²å°±ç»ª

---

## ğŸ“ è®¸å¯è¯

MIT

---

## ğŸ‘¥ ç»´æŠ¤è€…

@crayzgenius

**æœ€åæ›´æ–°**: 2026-02-04

