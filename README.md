# chatBI - æ™ºèƒ½é—®æ•°ç³»ç»Ÿ

> åŸºäºå¤§æ¨¡å‹çš„ä¼ä¸šçº§æ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼Œè®©æ•°æ®æŸ¥è¯¢åƒå¯¹è¯ä¸€æ ·ç®€å•ã€‚

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)
[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104+-green.svg)](https://fastapi.tiangolo.com)

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ§  ä¸‰å±‚æ··åˆæ„å›¾è¯†åˆ«
- **L1 è§„åˆ™å¼•æ“** - å¿«é€ŸåŒ¹é…å¸¸è§æ¨¡å¼ï¼ˆ<10msï¼‰
- **L2 å‘é‡å¬å›** - BGE-M3è¯­ä¹‰ç›¸ä¼¼åº¦ï¼ˆ<100msï¼‰
- **L3 LLMå¢å¼º** - æ™ºè°±AI GLM-4æ·±åº¦ç†è§£ï¼ˆ~5sï¼‰
- **å‡†ç¡®ç‡ 95%+** - è‡ªé€‚åº”é™çº§ï¼Œå¹³è¡¡é€Ÿåº¦ä¸å‡†ç¡®åº¦

### ğŸ“Š å®Œæ•´çš„æ•°æ®ä»“åº“
- **æ˜Ÿå‹æ¨¡å¼æ¶æ„** - 5ä¸ªç»´åº¦è¡¨ + 5ä¸ªäº‹å®è¡¨
- **PostgreSQLå­˜å‚¨** - ç”Ÿäº§çº§å…³ç³»å‹æ•°æ®åº“
- **25+ä¸šåŠ¡æŒ‡æ ‡** - è¦†ç›–ç”µå•†ã€ç”¨æˆ·ã€æµé‡ã€æ”¶å…¥ã€è´¢åŠ¡
- **ç‰©åŒ–è§†å›¾ä¼˜åŒ–** - é¢„èšåˆï¼Œ10-100å€æ€§èƒ½æå‡

### ğŸ” æ™ºèƒ½SQLç”Ÿæˆ
- **QueryIntent â†’ SQL** - è‡ªåŠ¨ç”ŸæˆPostgreSQLæŸ¥è¯¢
- **å¤šç»´åº¦JOIN** - æ”¯æŒåœ°åŒºã€å“ç±»ã€æ¸ é“ã€ç”¨æˆ·ç­‰çº§
- **æ—¶é—´èŒƒå›´è¿‡æ»¤** - æ—¥/å‘¨/æœˆè‡ªåŠ¨å¤„ç†
- **èšåˆæ“ä½œ** - SUM/AVG/COUNT/MAX/MIN

### ğŸ“ˆ å®Œæ•´çš„ç›‘æ§ä½“ç³»
- **Prometheusç›‘æ§** - 30+ä¸ªæ€§èƒ½å’Œä¸šåŠ¡æŒ‡æ ‡
- **Grafanaçœ‹æ¿** - 8ä¸ªå®æ—¶ç›‘æ§é¢æ¿
- **å‘Šè­¦è§„åˆ™** - å»¶è¿Ÿã€é”™è¯¯ç‡ã€èµ„æºå¼‚å¸¸
- **æ€§èƒ½åŸºå‡†æµ‹è¯•** - P50/P95/P99å»¶è¿Ÿç»Ÿè®¡

### ğŸ’¡ AIæ™ºèƒ½è§£è¯»
- **è¶‹åŠ¿åˆ†æ** - ä¸Šå‡/ä¸‹é™/æ³¢åŠ¨è¯†åˆ«
- **å¼‚å¸¸æ£€æµ‹** - è‡ªåŠ¨å‘ç°æ•°æ®å¼‚å¸¸ç‚¹
- **æ´å¯Ÿç”Ÿæˆ** - åŸºäºLLMçš„ä¸šåŠ¡æ´å¯Ÿ
- **å»ºè®®æ¨è** - æ•°æ®é©±åŠ¨çš„å†³ç­–å»ºè®®

### ğŸ” æ ¹å› åˆ†æï¼ˆNEW!ï¼‰
- **æ™ºèƒ½å¼‚å¸¸æ£€æµ‹** - 3ÏƒåŸåˆ™ã€IQRå››åˆ†ä½æ³•ã€ç§»åŠ¨å¹³å‡
- **ç»´åº¦åˆ†è§£** - è´¡çŒ®åº¦åˆ†æã€å¸•ç´¯æ‰˜åˆ†æ
- **è¶‹åŠ¿åˆ†æ** - çº¿æ€§å›å½’ã€RÂ²æ‹Ÿåˆã€è½¬æŠ˜ç‚¹æ£€æµ‹
- **å› æœæ¨æ–­** - ä¸šåŠ¡è§„åˆ™å¼•æ“ã€ç½®ä¿¡åº¦é‡åŒ–
- **å¯è§†åŒ–å±•ç¤º** - å¼‚å¸¸å¡ç‰‡ã€è¶‹åŠ¿å›¾è¡¨ã€å› æœå› ç´ ã€è¡ŒåŠ¨å»ºè®®

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚ Frontend"
        UI[Web UI<br/>index.html]
    end

    subgraph "APIå±‚ API Layer"
        FastAPI[FastAPI Server<br/>complete_query.py]
        Models[Pydantic Models<br/>æ•°æ®éªŒè¯]
    end

    subgraph "æ¨ç†å¼•æ“å±‚ Inference Layer"
        Intent[Intent Recognizer<br/>æ„å›¾è¯†åˆ«]
        RootCause[Root Cause Analyzer<br/>æ ¹å› åˆ†æ L4]
        Hybrid[Enhanced Hybrid<br/>ä¸‰å±‚æ··åˆè¯†åˆ«]
    end

    subgraph "å¬å›å±‚ Recall Layer"
        Vector[Vector Recall<br/>Qdrant + BGE-M3]
        Graph[Graph Recall<br/>Neo4jå›¾è°±]
    end

    subgraph "ç²¾æ’å±‚ Rerank Layer"
        Fusion[Fusion Ranker<br/>èåˆæ’åº]
        Features[11ç»´ç‰¹å¾<br/>æƒé‡è®¡ç®—]
    end

    subgraph "æ•°æ®å±‚ Data Layer"
        PG[(PostgreSQL<br/>æ•°æ®ä»“åº“)]
        Qdrant[(Qdrant<br/>å‘é‡åº“)]
        Neo4j[(Neo4j<br/>å›¾æ•°æ®åº“)]
    end

    subgraph "ç›‘æ§å±‚ Monitoring Layer"
        Prometheus[Prometheus<br/>æŒ‡æ ‡é‡‡é›†]
        Grafana[Grafana<br/>å¯è§†åŒ–çœ‹æ¿]
    end

    UI -->|HTTP Query| FastAPI
    FastAPI --> Models
    Models --> Intent
    Intent --> Hybrid
    Hybrid -->|L1 è§„åˆ™| Intent
    Hybrid -->|L2 å‘é‡| Vector
    Hybrid -->|L3 LLM| Intent
    Vector --> Qdrant
    Graph --> Neo4j
    Vector --> Fusion
    Graph --> Fusion
    Fusion --> Features
    FastAPI --> RootCause
    RootCause --> PG
    FastAPI --> PG
    FastAPI --> Prometheus
    Prometheus --> Grafana

    style UI fill:#e1f5ff
    style FastAPI fill:#fff4e1
    style Hybrid fill:#f3e5f5
    style Vector fill:#e8f5e9
    style Graph fill:#e8f5e9
    style Fusion fill:#fff9c4
    style PG fill:#ffccbc
    style RootCause fill:#f8d7da
    style Prometheus fill:#e1bee7
```

### æ•°æ®æµå›¾

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ ç”¨æˆ·
    participant UI as ğŸŒ å‰ç«¯
    participant API as âš¡ APIå±‚
    participant Intent as ğŸ§  æ„å›¾è¯†åˆ«
    participant Recall as ğŸ” å¬å›å±‚
    participant Rerank as ğŸ“Š ç²¾æ’å±‚
    participant RCA as ğŸ”¬ æ ¹å› åˆ†æ
    participant DB as ğŸ’¾ æ•°æ®åº“

    User->>UI: è¾“å…¥è‡ªç„¶è¯­è¨€æŸ¥è¯¢
    UI->>API: POST /api/v3/query
    API->>Intent: è¯†åˆ«æŸ¥è¯¢æ„å›¾

    alt ä¸‰å±‚æ··åˆæ„å›¾è¯†åˆ«
        Intent->>Intent: L1: è§„åˆ™å¼•æ“ (<10ms)
        alt L1æœªå‘½ä¸­
            Intent->>Intent: L2: å‘é‡å¬å› (<100ms)
            alt L2ç½®ä¿¡åº¦ä½
                Intent->>Intent: L3: LLMå¢å¼º (~5s)
            end
        end
    end

    Intent-->>API: è¿”å›QueryIntent

    alt å¬å›é˜¶æ®µ
        API->>Recall: åŒè·¯å¬å›
        Recall->>DB: å‘é‡æ£€ç´¢ (Qdrant)
        Recall->>DB: å›¾è°±æ£€ç´¢ (Neo4j)
        DB-->>Recall: è¿”å›å€™é€‰é›†
    end

    Recall-->>API: è¿”å›Top-Kå€™é€‰

    alt ç²¾æ’é˜¶æ®µ
        API->>Rerank: èåˆæ’åº
        Rerank->>Rerank: 11ç»´ç‰¹å¾è®¡ç®—
        Rerank-->>API: è¿”å›æ’åºç»“æœ
    end

    API->>DB: æ‰§è¡ŒSQLæŸ¥è¯¢
    DB-->>API: è¿”å›æŸ¥è¯¢ç»“æœ

    alt æ ¹å› åˆ†æè§¦å‘
        API->>RCA: è§¦å‘L4åˆ†æ
        RCA->>RCA: å¼‚å¸¸æ£€æµ‹
        RCA->>RCA: ç»´åº¦åˆ†è§£
        RCA->>RCA: è¶‹åŠ¿åˆ†æ
        RCA->>RCA: å› æœæ¨æ–­
        RCA-->>API: è¿”å›åˆ†ææŠ¥å‘Š
    end

    API-->>UI: è¿”å›å®Œæ•´ç»“æœ
    UI-->>User: å±•ç¤ºå¯è§†åŒ–ç»“æœ
```

### æ‰©å±•æ¶æ„è®¾è®¡

#### ğŸ“¦ æ¨¡å—åŒ–è®¾è®¡åŸåˆ™

chatBIé‡‡ç”¨**æ’ä»¶åŒ–æ¶æ„**ï¼Œæ‰€æœ‰æ ¸å¿ƒæ¨¡å—éƒ½éµå¾ªä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š

1. **æ¥å£éš”ç¦»**: æ¯å±‚å®šä¹‰æ¸…æ™°çš„æ¥å£å¥‘çº¦
2. **ä¾èµ–æ³¨å…¥**: é€šè¿‡é…ç½®æ³¨å…¥å…·ä½“å®ç°
3. **ç­–ç•¥æ¨¡å¼**: ç®—æ³•å¯æ›¿æ¢ï¼Œä¸å½±å“å…¶ä»–æ¨¡å—
4. **è§‚å¯Ÿè€…æ¨¡å¼**: äº‹ä»¶é©±åŠ¨çš„æ¨¡å—é€šä¿¡

#### ğŸ”Œ å¯æ‰©å±•ç‚¹è¯´æ˜

<details>
<summary>ğŸ“– ç‚¹å‡»æŸ¥çœ‹æ‰©å±•ç‚¹è¯¦æƒ…</summary>

**1. æ„å›¾è¯†åˆ«å±‚æ‰©å±•**

```python
# æ·»åŠ æ–°çš„æ„å›¾è¯†åˆ«ç­–ç•¥
class CustomIntentStrategy(IntentStrategy):
    def recognize(self, query: str) -> QueryIntent:
        # è‡ªå®šä¹‰è¯†åˆ«é€»è¾‘
        pass

# æ³¨å†Œç­–ç•¥
EnhancedHybridIntentRecognizer.register_strategy(
    layer=4,  # L4å±‚
    strategy=CustomIntentStrategy()
)
```

**æ‰©å±•æ–¹å‘**ï¼š
- æ·»åŠ é¢†åŸŸç‰¹å®šè¯†åˆ«å™¨ï¼ˆé‡‘èã€åŒ»ç–—ç­‰ï¼‰
- é›†æˆå…¶ä»–LLMï¼ˆGPT-4ã€Claudeç­‰ï¼‰
- è‡ªå®šä¹‰Few-shotç¤ºä¾‹åº“

---

**2. å¬å›å±‚æ‰©å±•**

```python
# æ·»åŠ æ–°çš„å¬å›æº
class CustomRecall(RecallBase):
    def recall(self, query: str, top_k: int) -> list[Result]:
        # è‡ªå®šä¹‰å¬å›é€»è¾‘
        pass

# æ³¨å†Œå¬å›æº
FusionRanker.register_recallback(
    name="custom_source",
    callback=CustomRecall()
)
```

**æ‰©å±•æ–¹å‘**ï¼š
- æ–°å¢å‘é‡æ•°æ®åº“ï¼ˆMilvusã€Pineconeç­‰ï¼‰
- æ–°å¢å›¾æ•°æ®åº“ï¼ˆHugeGraphã€TigerGraphç­‰ï¼‰
- æ·»åŠ å…¨æ–‡æ£€ç´¢ï¼ˆElasticSearchï¼‰
- æ·»åŠ çŸ¥è¯†å›¾è°±ï¼ˆConceptNetã€Wikidataï¼‰

---

**3. ç²¾æ’å±‚æ‰©å±•**

```python
# æ·»åŠ æ–°çš„æ’åºç‰¹å¾
def custom_feature_ranker(results: list[Result]) -> list[Result]:
    # è®¡ç®—è‡ªå®šä¹‰ç‰¹å¾
    for result in results:
        result.features['custom_score'] = calculate_custom(result)
    # é‡æ–°æ’åº
    return sorted(results, key=lambda x: x.features['custom_score'])

# æ³¨å†Œæ’åºå™¨
FusionRanker.register_ranker(
    name="custom_ranker",
    ranker=custom_feature_ranker,
    weight=0.2  # æƒé‡
)
```

**æ‰©å±•æ–¹å‘**ï¼š
- æ·»åŠ å­¦ä¹ æ’åºæ¨¡å‹ï¼ˆLearning to Rankï¼‰
- æ·»åŠ ä¸ªæ€§åŒ–æ’åº
- æ·»åŠ ä¸šåŠ¡è§„åˆ™æ’åº

---

**4. æ•°æ®æºæ‰©å±•**

```python
# æ·»åŠ æ–°çš„æ•°æ®æº
class CustomDataSource(DataSourceBase):
    def query(self, sql: str) -> list[dict]:
        # æ‰§è¡ŒæŸ¥è¯¢
        pass

    def get_schema(self) -> dict:
        # è¿”å›Schema
        pass

# æ³¨å†Œæ•°æ®æº
DataSourceManager.register(
    name="custom_db",
    source=CustomDataSource(),
    priority=1
)
```

**æ‰©å±•æ–¹å‘**ï¼š
- æ–°å¢æ•°æ®åº“ï¼ˆMySQLã€ClickHouseã€MongoDBç­‰ï¼‰
- æ–°å¢å¤§æ•°æ®æºï¼ˆHiveã€Sparkã€Prestoï¼‰
- æ–°å¢APIæ•°æ®æºï¼ˆREST APIã€GraphQLï¼‰

---

**5. ç›‘æ§æ‰©å±•**

```python
# æ·»åŠ è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡
from prometheus_client import Counter, Histogram

custom_counter = Counter(
    'chatbi_custom_operations_total',
    'Total custom operations',
    ['operation_type', 'status']
)

# ä½¿ç”¨æŒ‡æ ‡
custom_counter.labels(operation_type="custom_query", status="success").inc()
```

**æ‰©å±•æ–¹å‘**ï¼š
- æ·»åŠ ä¸šåŠ¡æŒ‡æ ‡ï¼ˆè½¬åŒ–ç‡ã€ç•™å­˜ç‡ç­‰ï¼‰
- æ·»åŠ æ€§èƒ½æŒ‡æ ‡ï¼ˆå„æ¨¡å—è€—æ—¶ï¼‰
- æ·»åŠ å‘Šè­¦è§„åˆ™ï¼ˆé’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ã€Slackï¼‰

---

**6. å‰ç«¯æ‰©å±•**

```javascript
// æ·»åŠ è‡ªå®šä¹‰å¯è§†åŒ–æ¨¡å—
function displayCustomModule(data) {
    const container = document.getElementById('custom-content');
    // è‡ªå®šä¹‰æ¸²æŸ“é€»è¾‘
    container.innerHTML = renderCustomVisualization(data);
}

// æ³¨å†Œæ¨¡å—
ModuleManager.register('custom', displayCustomModule);
```

**æ‰©å±•æ–¹å‘**ï¼š
- æ·»åŠ æ–°çš„å¯è§†åŒ–å›¾è¡¨ï¼ˆEChartsã€D3.jsï¼‰
- æ·»åŠ å¯¼å‡ºåŠŸèƒ½ï¼ˆExcelã€PDFã€PNGï¼‰
- æ·»åŠ åä½œåŠŸèƒ½ï¼ˆåˆ†äº«ã€è¯„è®ºã€æ”¶è—ï¼‰

</details>

#### ğŸš€ å¿«é€Ÿæ‰©å±•ç¤ºä¾‹

**åœºæ™¯1ï¼šæ·»åŠ æ–°çš„LLMæä¾›å•†**

```python
# src/inference/custom_llm.py
from zhipu_intent import ZhipuIntentRecognizer

class OpenAIIntentRecognizer(IntentRecognizer):
    """OpenAIæ„å›¾è¯†åˆ«å™¨"""

    def __init__(self, api_key: str):
        self.client = OpenAI(api_key=api_key)

    def recognize(self, query: str) -> QueryIntent:
        # ä½¿ç”¨GPT-4è¯†åˆ«æ„å›¾
        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[{"role": "user", "content": query}]
        )
        return self._parse_response(response)

# æ³¨å†Œä½¿ç”¨
# config.py
LLM_PROVIDER = os.getenv("LLM_PROVIDER", "zhipu")  # zhipu | openai | custom

# complete_query.py
if LLM_PROVIDER == "openai":
    llm_recognizer = OpenAIIntentRecognizer(api_key=os.getenv("OPENAI_API_KEY"))
elif LLM_PROVIDER == "zhipu":
    llm_recognizer = ZhipuIntentRecognizer(api_key=os.getenv("ZHIPUAI_API_KEY"))
```

**åœºæ™¯2ï¼šæ·»åŠ æ–°çš„å‘é‡æ•°æ®åº“**

```python
# src/recall/vector/milvus_store.py
from pymilvus import Collection, connections

class MilvusVectorStore(VectorStoreBase):
    """Milvuså‘é‡å­˜å‚¨"""

    def __init__(self, host: str, port: int):
        connections.connect(host=host, port=port)
        self.collection = Collection("metrics")

    def search(self, vector: list[float], top_k: int) -> list[Result]:
        results = self.collection.search(
            data=[vector],
            anns_field="embedding",
            param={"metric_type": "IP", "params": {"nprobe": 10}},
            limit=top_k
        )
        return self._parse_results(results)

# æ›¿æ¢Qdrant
# config.py
VECTOR_DB = os.getenv("VECTOR_DB", "qdrant")  # qdrant | milvus | pinecone
```

**åœºæ™¯3ï¼šæ·»åŠ æ–°çš„åˆ†ææ¨¡å—**

```python
# src/inference/anomaly_detector.py
class AnomalyDetector:
    """å¼‚å¸¸æ£€æµ‹å™¨ - å¯æ’æ‹”è®¾è®¡"""

    DETECTORS = {
        "3sigma": detect_3sigma,
        "iqr": detect_iqr,
        "isolation_forest": detect_isolation_forest,  # æ–°å¢
        "lstm": detect_lstm_anomaly,  # æ–°å¢
    }

    def detect(self, data: list[float], method: str = "3sigma"):
        detector = self.DETECTORS.get(method, detect_3sigma)
        return detector(data)

# ä½¿ç”¨æ–°ç®—æ³•
anomalies = detector.detect(data, method="isolation_forest")
```

### æ¶æ„ä¼˜åŠ¿æ€»ç»“

| ç‰¹æ€§ | è¯´æ˜ | ä¼˜åŠ¿ |
|------|------|------|
| **åˆ†å±‚æ¶æ„** | API â†’ æ¨ç† â†’ å¬å› â†’ ç²¾æ’ â†’ æ•°æ® | èŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤ |
| **æ’ä»¶åŒ–è®¾è®¡** | æ‰€æœ‰æ ¸å¿ƒç»„ä»¶å¯æ›¿æ¢ | çµæ´»æ‰©å±•ï¼Œé€‚åº”ä¸åŒåœºæ™¯ |
| **å¤šæ•°æ®æºæ”¯æŒ** | PostgreSQL + Qdrant + Neo4j | å……åˆ†åˆ©ç”¨å„æ•°æ®åº“ä¼˜åŠ¿ |
| **æ··åˆæ£€ç´¢** | å‘é‡ + å›¾è°± + è§„åˆ™ | å¬å›ç‡é«˜ï¼Œå‡†ç¡®åº¦å¥½ |
| **ç›‘æ§å®Œå–„** | Prometheus + Grafana | é—®é¢˜å¿«é€Ÿå®šä½ |
| **æµ‹è¯•è¦†ç›–** | å•å…ƒ + é›†æˆ + E2E | è´¨é‡å¯æ§ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/JourneytoNewland/chatBI.git
cd chatBI

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv .venv
source .venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®ï¼ˆå¿…éœ€ï¼šè®¾ç½®æ™ºè°±AI API Keyï¼‰
# ZHIPUAI_API_KEY=your-api-key-here
```

### 3. å¯åŠ¨æœåŠ¡

#### æ–¹å¼Aï¼šæ¼”ç¤ºæ¨¡å¼ï¼ˆæ¨èæ–°æ‰‹ï¼‰

```bash
# ä¸€é”®å¯åŠ¨ï¼ˆå†…ç½®æ¨¡æ‹Ÿæ•°æ®ï¼‰
bash scripts/run_demo.sh
```

è®¿é—® http://localhost:8080 æŸ¥çœ‹å‰ç«¯ç•Œé¢

#### æ–¹å¼Bï¼šå®Œæ•´æ¨¡å¼ï¼ˆéœ€è¦Dockerï¼‰

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆPostgreSQL + Qdrant + Neo4jï¼‰
docker compose up -d

# åˆå§‹åŒ–æ•°æ®åº“
bash scripts/init-postgres.sh

# å¯åŠ¨APIæœåŠ¡
python scripts/run-production-server.py
```

### 4. å¯åŠ¨ç›‘æ§ï¼ˆå¯é€‰ï¼‰

```bash
# å¯åŠ¨Prometheus + Grafana
bash scripts/monitoring/run-monitoring.sh

# è®¿é—®ç›‘æ§ç•Œé¢
# Prometheus: http://localhost:9090
# Grafana: http://localhost:3000 (admin/admin)
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### APIæŸ¥è¯¢ç¤ºä¾‹

```bash
# ç®€å•æŸ¥è¯¢
curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "æœ€è¿‘7å¤©GMV"}'

# ç»´åº¦åˆ†ç»„
curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "æŒ‰åœ°åŒºç»Ÿè®¡DAU"}'

# å¤æ‚æŸ¥è¯¢
curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "æœ¬æœˆæŒ‰æ¸ é“GMVæ€»å’Œ"}'

# æ ¹å› åˆ†ææŸ¥è¯¢
curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "ä¸ºä»€ä¹ˆGMVæœ€è¿‘ä¸‹é™äº†ï¼Ÿ"}'

curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "åˆ†æDAUä¸‹é™çš„åŸå› "}'

curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "è½¬åŒ–ç‡æ€ä¹ˆäº†"}'
```

### Python SDK

```python
from src.inference.enhanced_hybrid import EnhancedHybridIntentRecognizer

# åˆå§‹åŒ–è¯†åˆ«å™¨
recognizer = EnhancedHybridIntentRecognizer(llm_provider="zhipu")

# æ‰§è¡ŒæŸ¥è¯¢
result = recognizer.recognize("æœ€è¿‘7å¤©æˆäº¤é‡‘é¢")

print(f"æ ¸å¿ƒæŸ¥è¯¢: {result.final_intent.core_query}")
print(f"æ—¶é—´ç²’åº¦: {result.final_intent.time_granularity}")
print(f"ç½®ä¿¡åº¦: {result.final_intent.confidence}")
```

### ğŸ” æ ¹å› åˆ†æä½¿ç”¨æŒ‡å—

æ ¹å› åˆ†ææ˜¯chatBIçš„L4å±‚åŠŸèƒ½ï¼Œç”¨äºæ™ºèƒ½è¯Šæ–­æ•°æ®å¼‚å¸¸èƒŒåçš„åŸå› ã€‚

**è§¦å‘æ¡ä»¶**ï¼š
- æŸ¥è¯¢åŒ…å«"ä¸ºä»€ä¹ˆ"ã€"åŸå› "ã€"æ€ä¹ˆå›äº‹"ã€"åˆ†æ"ã€"è¯Šæ–­"ç­‰å…³é”®è¯
- æŸ¥è¯¢åŒ…å«è¶‹åŠ¿è¯ï¼ˆ"ä¸‹é™"ã€"å¢é•¿"ã€"å¼‚å¸¸"ã€"æ³¢åŠ¨"ç­‰ï¼‰
- æŸ¥è¯¢è¿”å›çš„æ•°æ®ç‚¹â‰¥3ä¸ª

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```bash
# 1. åˆ†æä¸‹é™åŸå› 
curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "ä¸ºä»€ä¹ˆGMVæœ€è¿‘ä¸‹é™äº†ï¼Ÿ"}'

# 2. åˆ†ææ³¢åŠ¨åŸå› 
curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "DAUæœ€è¿‘æ³¢åŠ¨æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ"}'

# 3. é—®é¢˜è¯Šæ–­
curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "è¯Šæ–­è½¬åŒ–ç‡å¼‚å¸¸"}'

# 4. ç»¼åˆåˆ†æ
curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "åˆ†ææœ€è¿‘30å¤©æŒ‰åœ°åŒºçš„GMVå˜åŒ–è¶‹åŠ¿"}'
```

**æ ¹å› åˆ†æè¾“å‡º**ï¼š

```json
{
  "query": "ä¸ºä»€ä¹ˆGMVæœ€è¿‘ä¸‹é™äº†ï¼Ÿ",
  "root_cause_analysis": {
    "report": "GMVåœ¨æœ€è¿‘7å¤©ä¸‹é™äº†15.2%ï¼Œä¸»è¦åŸå› æ˜¯åä¸œåœ°åŒºè´¡çŒ®åº¦ä¸‹é™äº†60%ï¼Œè¯¥åœ°åŒºGMVä»500ä¸‡é™è‡³200ä¸‡ã€‚è¶‹åŠ¿åˆ†ææ˜¾ç¤ºGMVåœ¨3å¤©å‰å‡ºç°æ˜æ˜¾æ‹ç‚¹ï¼ŒRÂ²=0.89ã€‚",
    "anomalies": [
      {"index": 5, "value": 380, "z_score": -2.8, "severity": "high"}
    ],
    "dimension_breakdown": [
      {"dimension": "åœ°åŒº", "value": "åä¸œ", "contribution": -0.6, "change": "-60%"},
      {"dimension": "åœ°åŒº", "value": "åå—", "contribution": 0.1, "change": "+10%"}
    ],
    "trend_analysis": {
      "direction": "downward",
      "slope": -15.2,
      "r_squared": 0.89,
      "turning_point": 5
    },
    "causal_factors": [
      {
        "category": "internal",
        "factor": "ä¾›åº”é“¾é—®é¢˜",
        "confidence": 0.85,
        "evidence": ["åº“å­˜ä¸è¶³", "ç‰©æµå»¶è¿Ÿ"],
        "actionable": true
      }
    ]
  }
}
```

**åˆ†æèƒ½åŠ›**ï¼š

| åˆ†æç±»å‹ | æ–¹æ³• | è¾“å‡º |
|---------|------|------|
| **å¼‚å¸¸æ£€æµ‹** | 3ÏƒåŸåˆ™ã€IQRå››åˆ†ä½æ³•ã€ç§»åŠ¨å¹³å‡ | å¼‚å¸¸ç‚¹ã€Z-Scoreã€ä¸¥é‡ç¨‹åº¦ |
| **ç»´åº¦åˆ†è§£** | è´¡çŒ®åº¦åˆ†æã€å¸•ç´¯æ‰˜åˆ†æ | å„ç»´åº¦è´¡çŒ®åº¦ã€å˜åŒ–ç™¾åˆ†æ¯” |
| **è¶‹åŠ¿åˆ†æ** | çº¿æ€§å›å½’ã€RÂ²æ‹Ÿåˆ | è¶‹åŠ¿æ–¹å‘ã€æ–œç‡ã€æ‹ç‚¹ä½ç½® |
| **å› æœæ¨æ–­** | ä¸šåŠ¡è§„åˆ™å¼•æ“ | å¯èƒ½åŸå› ã€ç½®ä¿¡åº¦ã€è¡ŒåŠ¨å»ºè®® |

è¯¦ç»†æ–‡æ¡£ï¼š[æ ¹å› åˆ†æä½¿ç”¨æŒ‡å—](docs/ROOT_CAUSE_USAGE.md)

## ğŸ“Š æ”¯æŒçš„æŒ‡æ ‡

| åˆ†ç±» | æŒ‡æ ‡ | ç¤ºä¾‹æŸ¥è¯¢ |
|------|------|---------|
| **ç”µå•†** | GMVã€è®¢å•é‡ã€å®¢å•ä»· | "æœ€è¿‘7å¤©GMV" |
| **ç”¨æˆ·** | DAUã€MAUã€ç•™å­˜ç‡ | "æŒ‰æ¸ é“ç»Ÿè®¡DAU" |
| **æµé‡** | è½¬åŒ–ç‡ã€åŠ è´­ç‡ | "æœ¬å‘¨è½¬åŒ–ç‡" |
| **æ”¶å…¥** | ARPUã€ARPPUã€LTV | "æœ¬æœˆARPU" |
| **è´¢åŠ¡** | è¥æ”¶ã€åˆ©æ¶¦ç‡ã€ROI | "æŒ‰åœ°åŒºåˆ©æ¶¦ç‡" |

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

<details>
<summary>ğŸ“ ç‚¹å‡»å±•å¼€å®Œæ•´ç›®å½•ç»“æ„</summary>

```
chatBI/
â”œâ”€â”€ ğŸ“„ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ README.md                    # é¡¹ç›®ä¸»æ–‡æ¡£
â”‚   â”œâ”€â”€ CLAUDE.md                    # å¼€å‘æŒ‡å—
â”‚   â”œâ”€â”€ .gitignore                   # Gitå¿½ç•¥é…ç½®
â”‚   â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–
â”‚   â”œâ”€â”€ docker-compose.yml           # Dockerç¼–æ’
â”‚   â””â”€â”€ .pre-commit-config.yaml      # Pre-commité’©å­
â”‚
â”œâ”€â”€ ğŸ æºä»£ç  (src/)
â”‚   â”œâ”€â”€ api/                         # APIå±‚ï¼ˆFastAPIï¼‰
â”‚   â”‚   â”œâ”€â”€ main.py                  # FastAPIä¸»åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ complete_query.py        # å®Œæ•´æŸ¥è¯¢APIï¼ˆL1-L4é›†æˆï¼‰
â”‚   â”‚   â”œâ”€â”€ models.py                # Pydanticæ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ v2_query_api.py          # API v2ç‰ˆæœ¬
â”‚   â”‚
â”‚   â”œâ”€â”€ inference/                   # æ¨ç†å¼•æ“
â”‚   â”‚   â”œâ”€â”€ intent.py                # æ„å›¾å®šä¹‰ä¸è¯†åˆ«å™¨
â”‚   â”‚   â”œâ”€â”€ enhanced_hybrid.py       # ä¸‰å±‚æ··åˆæ„å›¾è¯†åˆ«
â”‚   â”‚   â”œâ”€â”€ llm_intent.py            # LLMæ„å›¾è¯†åˆ«
â”‚   â”‚   â”œâ”€â”€ zhipu_intent.py          # æ™ºè°±AIæ„å›¾è¯†åˆ«
â”‚   â”‚   â””â”€â”€ root_cause/              # æ ¹å› åˆ†ææ¨¡å—ï¼ˆL4å±‚ï¼‰
â”‚   â”‚       â”œâ”€â”€ analyzer.py          # åˆ†æå™¨å®ç°
â”‚   â”‚       â””â”€â”€ root_cause_analyzer.py # ä¸»å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ recall/                      # å¬å›å±‚
â”‚   â”‚   â”œâ”€â”€ vector/                  # å‘é‡å¬å›
â”‚   â”‚   â”‚   â”œâ”€â”€ qdrant_store.py      # Qdrantå­˜å‚¨
â”‚   â”‚   â”‚   â””â”€â”€ vectorizer.py        # BGE-M3å‘é‡åŒ–
â”‚   â”‚   â””â”€â”€ graph/                   # å›¾è°±å¬å›
â”‚   â”‚       â”œâ”€â”€ neo4j_client.py      # Neo4jå®¢æˆ·ç«¯
â”‚   â”‚       â””â”€â”€ graph_store.py       # å›¾è°±å­˜å‚¨
â”‚   â”‚
â”‚   â”œâ”€â”€ rerank/                      # ç²¾æ’å±‚
â”‚   â”‚   â”œâ”€â”€ ranker.py                # æ’åºå™¨
â”‚   â”‚   â””â”€â”€ fusion_ranker.py         # èåˆæ’åº
â”‚   â”‚
â”‚   â”œâ”€â”€ mql/                         # MQLå¼•æ“
â”‚   â”‚   â”œâ”€â”€ engine_v2.py             # MQLæ‰§è¡Œå¼•æ“V2
â”‚   â”‚   â”œâ”€â”€ sql_generator_v2.py      # SQLç”Ÿæˆå™¨V2
â”‚   â”‚   â”œâ”€â”€ intelligent_interpreter.py # æ™ºèƒ½è§£è¯»
â”‚   â”‚   â””â”€â”€ models.py                # MQLæ•°æ®æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ database/                    # æ•°æ®åº“
â”‚   â”‚   â”œâ”€â”€ postgres_client.py       # PostgreSQLå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ migrations/              # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â””â”€â”€ init_test_data.py         # æµ‹è¯•æ•°æ®
â”‚   â”‚
â”‚   â”œâ”€â”€ embedding/                   # åµŒå…¥æ¨¡å‹
â”‚   â”‚   â””â”€â”€ bge_embedding.py          # BGEåµŒå…¥
â”‚   â”‚
â”‚   â”œâ”€â”€ validator/                   # éªŒè¯å™¨
â”‚   â”‚   â””â”€â”€ query_validator.py       # æŸ¥è¯¢éªŒè¯
â”‚   â”‚
â”‚   â”œâ”€â”€ monitoring/                  # ç›‘æ§æ¨¡å—
â”‚   â”‚   â””â”€â”€ metrics.py               # PrometheusæŒ‡æ ‡å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                    # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â””â”€â”€ summary_service.py       # æ‘˜è¦ç”ŸæˆæœåŠ¡
â”‚   â”‚
â”‚   â””â”€â”€ config.py                    # é…ç½®ç®¡ç†
â”‚
â”œâ”€â”€ ğŸ§ª æµ‹è¯• (tests/)
â”‚   â”œâ”€â”€ test_inference/              # æ¨ç†æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_root_cause.py       # æ ¹å› åˆ†ææµ‹è¯•
â”‚   â”‚   â””â”€â”€ test_intent_integration.py # æ„å›¾é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_integration/            # é›†æˆæµ‹è¯•
â”‚   â”‚   â””â”€â”€ test_full_query_flow.py  # å®Œæ•´æµç¨‹æµ‹è¯•
â”‚   â”œâ”€â”€ test_api/                    # APIæµ‹è¯•
â”‚   â”œâ”€â”€ test_mql/                    # MQLæµ‹è¯•
â”‚   â”œâ”€â”€ test_recall/                 # å¬å›æµ‹è¯•
â”‚   â”œâ”€â”€ test_rerank/                 # ç²¾æ’æµ‹è¯•
â”‚   â”œâ”€â”€ test_services/               # æœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ test_validator/              # éªŒè¯æµ‹è¯•
â”‚   â””â”€â”€ performance/                 # æ€§èƒ½æµ‹è¯•
â”‚       â”œâ”€â”€ load_test.py            # Locustå‹åŠ›æµ‹è¯•
â”‚       â””â”€â”€ benchmark.py            # åŸºå‡†æµ‹è¯•
â”‚
â”œâ”€â”€ ğŸ“± å‰ç«¯ (frontend/)
â”‚   â”œâ”€â”€ index.html                   # ä¸»ç•Œé¢
â”‚   â”œâ”€â”€ intent-visualization-v2.html # æ„å›¾å¯è§†åŒ–
â”‚   â”œâ”€â”€ pipeline-*.html              # æµç¨‹å¯è§†åŒ–
â”‚   â”œâ”€â”€ graph-management*.html       # å›¾è°±ç®¡ç†
â”‚   â”œâ”€â”€ dashboard.html               # ä»ªè¡¨æ¿
â”‚   â”œâ”€â”€ diagnose.html                # è¯Šæ–­é¡µé¢
â”‚   â”œâ”€â”€ test_root_cause_frontend.html # æ ¹å› åˆ†ææ¼”ç¤º
â”‚   â””â”€â”€ archive/                     # å†å²ç‰ˆæœ¬å½’æ¡£
â”‚
â”œâ”€â”€ ğŸ“š æ–‡æ¡£ (docs/)
â”‚   â”œâ”€â”€ README.md                    # æ–‡æ¡£ç´¢å¼•
â”‚   â”œâ”€â”€ ROOT_CAUSE_USAGE.md          # æ ¹å› åˆ†æä½¿ç”¨æŒ‡å—
â”‚   â”œâ”€â”€ SECURITY_CHECK_SUMMARY.md    # å®‰å…¨æ£€æŸ¥æŠ¥å‘Š
â”‚   â”œâ”€â”€ root_cause_analysis_summary.md # æ ¹å› åˆ†ææ€»ç»“
â”‚   â”œâ”€â”€ POSTGRESQL_INTEGRATION.md    # PostgreSQLé›†æˆ
â”‚   â”œâ”€â”€ INTENT_RECOGNITION_ARCHITECTURE.md # æ„å›¾è¯†åˆ«æ¶æ„
â”‚   â”œâ”€â”€ MQL_SYSTEM_SUMMARY.md        # MQLç³»ç»Ÿæ–‡æ¡£
â”‚   â”œâ”€â”€ SECURITY_BEST_PRACTICES.md   # å®‰å…¨æœ€ä½³å®è·µ
â”‚   â”œâ”€â”€ ARCHITECTURE.md              # ç³»ç»Ÿæ¶æ„
â”‚   â”œâ”€â”€ PROJECT_STRUCTURE_ANALYSIS.md # é¡¹ç›®ç»“æ„åˆ†æ
â”‚   â””â”€â”€ archive/                     # å†å²æ–‡æ¡£å½’æ¡£
â”‚       â”œâ”€â”€ ã€æ–¹æ¡ˆä¸‰ã€‘...
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ”§ è„šæœ¬ (scripts/)
â”‚   â”œâ”€â”€ run_demo_server.py           # æ¼”ç¤ºæœåŠ¡å™¨
â”‚   â”œâ”€â”€ run_dev_server.py            # å¼€å‘æœåŠ¡å™¨
â”‚   â”œâ”€â”€ run-production-server.py     # ç”Ÿäº§æœåŠ¡å™¨
â”‚   â”œâ”€â”€ init_seed_data.py            # åˆå§‹åŒ–ç§å­æ•°æ®
â”‚   â”œâ”€â”€ init_graph.py                # åˆå§‹åŒ–å›¾è°±
â”‚   â”œâ”€â”€ quick_init_qdrant.py         # å¿«é€Ÿåˆå§‹åŒ–Qdrant
â”‚   â”œâ”€â”€ benchmark.py                 # æ€§èƒ½åŸºå‡†
â”‚   â”œâ”€â”€ acceptance_test.py           # éªŒæ”¶æµ‹è¯•
â”‚   â”œâ”€â”€ setup/                       # è®¾ç½®å’Œå¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ testing/                     # æµ‹è¯•å’Œè¯Šæ–­è„šæœ¬
â”‚   â””â”€â”€ monitoring/                  # ç›‘æ§å¯åŠ¨è„šæœ¬
â”‚       â””â”€â”€ run-monitoring.sh        # å¯åŠ¨Prometheus+Grafana
â”‚
â”œâ”€â”€ ğŸ“Š ç›‘æ§ (monitoring/)
â”‚   â”œâ”€â”€ prometheus/                  # Prometheusé…ç½®
â”‚   â””â”€â”€ grafana/                     # Grafanaçœ‹æ¿
â”‚
â””â”€â”€ ğŸ³ åŸºç¡€è®¾æ–½
    â”œâ”€â”€ docker-compose.yml            # Dockerç¼–æ’
    â””â”€â”€ .dockerignore                 # Dockerå¿½ç•¥
```

</details>

<details>
<summary>ğŸ“– æ¨¡å—è¯´æ˜</summary>

### æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | èŒè´£ | å…³é”®æ–‡ä»¶ |
|------|------|---------|
| **APIå±‚** | FastAPIæ¥å£ã€è¯·æ±‚å¤„ç† | `main.py`, `complete_query.py` |
| **æ¨ç†å¼•æ“** | æ„å›¾è¯†åˆ«ã€æ ¹å› åˆ†æ | `intent.py`, `enhanced_hybrid.py`, `root_cause/` |
| **å¬å›å±‚** | å‘é‡å¬å›ã€å›¾è°±å¬å› | `vector/`, `graph/` |
| **ç²¾æ’å±‚** | ç»“æœæ’åºã€èåˆæ’åº | `ranker.py`, `fusion_ranker.py` |
| **MQLå¼•æ“** | MQLæ‰§è¡Œã€SQLç”Ÿæˆ | `engine_v2.py`, `sql_generator_v2.py` |
| **æ•°æ®åº“** | PostgreSQLæ“ä½œã€æ•°æ®è¿ç§» | `postgres_client.py`, `migrations/` |

### ç›®å½•ç»„ç»‡åŸåˆ™

1. **æ¨¡å—åŒ–**: æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æ¨¡å—ï¼ŒèŒè´£å•ä¸€
2. **åˆ†å±‚æ¶æ„**: API â†’ æ¨ç† â†’ å¬å› â†’ ç²¾æ’ â†’ æ•°æ®
3. **æµ‹è¯•è¦†ç›–**: å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + æ€§èƒ½æµ‹è¯•
4. **æ–‡æ¡£å®Œå–„**: åŠŸèƒ½æ–‡æ¡£ + æ¶æ„æ–‡æ¡£ + å†å²å½’æ¡£

</details>

<details>
<summary>ğŸ¯ å¼€å‘è§„èŒƒ</summary>

### æ–‡ä»¶å‘½å

- Pythonæ¨¡å—: `snake_case.py`
- æµ‹è¯•æ–‡ä»¶: `test_*.py`
- æ–‡æ¡£æ–‡ä»¶: `FEATURE_NAME.md`
- é…ç½®æ–‡ä»¶: `*.yaml`, `*.yml`, `*.json`

### Gitè§„èŒƒ

- âœ… .gitignore åŒ…å«æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶
- âœ… æ•æ„Ÿä¿¡æ¯åœ¨ `.env` ä¸­ï¼ˆä¸æäº¤ï¼‰
- âœ… æ–‡æ¡£å½’æ¡£åœ¨ `docs/archive/`
- âœ… Conventional Commits æ ¼å¼

### ä»£ç è´¨é‡

- ç±»å‹æ³¨è§£: æ‰€æœ‰å‡½æ•°å¿…é¡»æœ‰ç±»å‹æ³¨è§£
- æ–‡æ¡£å­—ç¬¦ä¸²: Googleé£æ ¼
- æµ‹è¯•è¦†ç›–: ç›®æ ‡ 80%+
- ä»£ç å®¡æŸ¥: æäº¤å‰è‡ªæˆ‘å®¡æŸ¥

</details>
â”‚       â”œâ”€â”€ load_test.py      # Locustå‹åŠ›æµ‹è¯•
â”‚       â””â”€â”€ benchmark.py      # åŸºå‡†æµ‹è¯•
â”‚
â”œâ”€â”€ docker-compose.yml         # Dockerç¼–æ’
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â””â”€â”€ README.md                  # æœ¬æ–‡æ¡£
```

## ğŸ”§ é…ç½®è¯´æ˜

### æ™ºè°±AI APIï¼ˆå¿…éœ€ï¼‰

**âš ï¸ å®‰å…¨è­¦å‘Šï¼šä¸¥ç¦å°†API Keyç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼**

æ­£ç¡®é…ç½®æ–¹å¼ï¼š

```bash
# æ–¹å¼1: å‘½ä»¤è¡Œè®¾ç½®
export ZHIPUAI_API_KEY="your-api-key"

# æ–¹å¼2: .envæ–‡ä»¶
echo "ZHIPUAI_API_KEY=your-api-key" >> .env

# æ–¹å¼3: è¿è¡Œæ—¶ä¼ å…¥
ZHIPUAI_API_KEY="your-api-key" python app.py
```

é…ç½®éªŒè¯ï¼š
```bash
python -c "import os; print('âœ… é…ç½®æˆåŠŸ' if os.getenv('ZHIPUAI_API_KEY') else 'âŒ æœªé…ç½®')"
```

### æ¨¡å‹é€‰æ‹©

| æ¨¡å‹ | é€Ÿåº¦ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| glm-4-flash | å¿« | å…è´¹ | å¼€å‘æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒ |
| glm-4-plus | ä¸­ | Â¥1/1M tokens | é«˜å‡†ç¡®ç‡è¦æ±‚ |
| glm-4-0520 | æ…¢ | Â¥1/1M tokens | æœ€æ–°æ¨¡å‹ |

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| P50å»¶è¿Ÿ | <100ms | å¾…æµ‹ | - |
| P95å»¶è¿Ÿ | <300ms | å¾…æµ‹ | - |
| P99å»¶è¿Ÿ | <500ms | å¾…æµ‹ | - |
| å¹¶å‘èƒ½åŠ› | 1000 QPS | å¾…æµ‹ | - |
| æ„å›¾è¯†åˆ«å‡†ç¡®ç‡ | >95% | 95%+ | âœ… |

## ğŸ” ç›‘æ§çœ‹æ¿

å¯åŠ¨ç›‘æ§æœåŠ¡åè®¿é—®ï¼š

- **Grafana**: http://localhost:3000
  - ç”¨æˆ·å: `admin`
  - å¯†ç : `admin`
  - é¢„é…ç½®çœ‹æ¿: chatBI ç³»ç»Ÿæ¦‚è§ˆ

- **Prometheus**: http://localhost:9090
  - æŸ¥è¯¢åŸå§‹æŒ‡æ ‡
  - æŸ¥çœ‹å‘Šè­¦è§„åˆ™

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# æ€§èƒ½åŸºå‡†æµ‹è¯•
python scripts/benchmark.py

# Locustå‹åŠ›æµ‹è¯•
locust -f tests/performance/load_test.py --host=http://localhost:8000
```

### æµ‹è¯•è¦†ç›–ç‡

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=src --cov-report=html
```

## ğŸ“š æ–‡æ¡£

### æ ¸å¿ƒåŠŸèƒ½
- [æ ¹å› åˆ†æä½¿ç”¨æŒ‡å—](docs/ROOT_CAUSE_USAGE.md) - L4å±‚æ ¹å› åˆ†æå®Œæ•´æ–‡æ¡£
- [PostgreSQLé›†æˆæŒ‡å—](docs/POSTGRESQL_INTEGRATION.md) - æ•°æ®ä»“åº“æ¶æ„
- [æ„å›¾è¯†åˆ«æ–‡æ¡£](docs/intent_recognition_summary.md) - ä¸‰å±‚æ··åˆæ„å›¾è¯†åˆ«
- [MQLç³»ç»Ÿæ–‡æ¡£](docs/MQL_SYSTEM_SUMMARY.md) - MQLå¼•æ“ä¸SQLç”Ÿæˆ

### è¿ç»´ç›‘æ§
- [ç›‘æ§ç³»ç»ŸæŒ‡å—](monitoring/README.md) - Prometheus + Grafana
- [æ€§èƒ½æµ‹è¯•æŒ‡å—](tests/performance/README.md) - åŸºå‡†æµ‹è¯•ä¸å‹åŠ›æµ‹è¯•
- [å®‰å…¨æœ€ä½³å®è·µ](docs/SECURITY_BEST_PRACTICES.md) - å®‰å…¨é…ç½®ä¸å®¡è®¡

### å†å²æ–‡æ¡£
- [å†å²æ–‡æ¡£å½’æ¡£](docs/archive/) - å¼€å‘è¿‡ç¨‹æ–‡æ¡£

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'feat: Add AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ™ è‡´è°¢

- [æ™ºè°±AI](https://open.bigmodel.cn/) - æä¾›GLM-4æ¨¡å‹æ”¯æŒ
- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£åŒ–çš„Python Webæ¡†æ¶
- [PostgreSQL](https://www.postgresql.org/) - å¼ºå¤§çš„å¼€æºæ•°æ®åº“
- [Qdrant](https://qdrant.tech/) - å‘é‡æœç´¢å¼•æ“
- [Prometheus](https://prometheus.io/) - ç›‘æ§ç³»ç»Ÿ

## ğŸ“® è”ç³»æ–¹å¼

- é¡¹ç›®åœ°å€: https://github.com/JourneytoNewland/chatBI
- é—®é¢˜åé¦ˆ: [GitHub Issues](https://github.com/JourneytoNewland/chatBI/issues)

---

**å½“å‰ç‰ˆæœ¬**: v2.1
**æœ€åæ›´æ–°**: 2026-02-08
**ç»´æŠ¤è€…**: Crazygeniusï¼ˆç‹æ‹¯ï¼‰
