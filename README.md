# chatBI - æ™ºèƒ½é—®æ•°ç³»ç»Ÿ

> åŸºäºå¤§æ¨¡å‹çš„ä¼ä¸šçº§æ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼Œè®©æ•°æ®æŸ¥è¯¢åƒå¯¹è¯ä¸€æ ·ç®€å•ã€‚

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)
[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104+-green.svg)](https://fastapi.tiangolo.com)

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ§  ä¸‰å±‚æ··åˆæ„å›¾è¯†åˆ«
- **L1 è§„åˆ™å¼•æ“** - å¿«é€ŸåŒ¹é…å¸¸è§æ¨¡å¼ï¼ˆ<10msï¼‰
- **L2 å‘é‡å¬å›** - BGE-M3è¯­ä¹‰ç›¸ä¼¼åº¦ï¼ˆ<100msï¼‰
- **L3 LLMå¢å¼º** - æ™ºè°±AI GLM-4æ·±åº¦ç†è§£ï¼ˆ~5sï¼‰
- **å‡†ç¡®ç‡ 95%+** - è‡ªé€‚åº”é™çº§ï¼Œå¹³è¡¡é€Ÿåº¦ä¸å‡†ç¡®åº¦

### ğŸ“Š å®Œæ•´çš„æ•°æ®ä»“åº“
- **æ˜Ÿå‹æ¨¡å¼æ¶æ„** - 5ä¸ªç»´åº¦è¡¨ + 5ä¸ªäº‹å®è¡¨
- **PostgreSQLå­˜å‚¨** - ç”Ÿäº§çº§å…³ç³»å‹æ•°æ®åº“
- **25+ä¸šåŠ¡æŒ‡æ ‡** - è¦†ç›–ç”µå•†ã€ç”¨æˆ·ã€æµé‡ã€æ”¶å…¥ã€è´¢åŠ¡
- **ç‰©åŒ–è§†å›¾ä¼˜åŒ–** - é¢„èšåˆï¼Œ10-100å€æ€§èƒ½æå‡

### ğŸ” æ™ºèƒ½SQLç”Ÿæˆ
- **QueryIntent â†’ SQL** - è‡ªåŠ¨ç”ŸæˆPostgreSQLæŸ¥è¯¢
- **å¤šç»´åº¦JOIN** - æ”¯æŒåœ°åŒºã€å“ç±»ã€æ¸ é“ã€ç”¨æˆ·ç­‰çº§
- **æ—¶é—´èŒƒå›´è¿‡æ»¤** - æ—¥/å‘¨/æœˆè‡ªåŠ¨å¤„ç†
- **èšåˆæ“ä½œ** - SUM/AVG/COUNT/MAX/MIN

### ğŸ“ˆ å®Œæ•´çš„ç›‘æ§ä½“ç³»
- **Prometheusç›‘æ§** - 30+ä¸ªæ€§èƒ½å’Œä¸šåŠ¡æŒ‡æ ‡
- **Grafanaçœ‹æ¿** - 8ä¸ªå®æ—¶ç›‘æ§é¢æ¿
- **å‘Šè­¦è§„åˆ™** - å»¶è¿Ÿã€é”™è¯¯ç‡ã€èµ„æºå¼‚å¸¸
- **æ€§èƒ½åŸºå‡†æµ‹è¯•** - P50/P95/P99å»¶è¿Ÿç»Ÿè®¡

### ğŸ’¡ AIæ™ºèƒ½è§£è¯»
- **è¶‹åŠ¿åˆ†æ** - ä¸Šå‡/ä¸‹é™/æ³¢åŠ¨è¯†åˆ«
- **å¼‚å¸¸æ£€æµ‹** - è‡ªåŠ¨å‘ç°æ•°æ®å¼‚å¸¸ç‚¹
- **æ´å¯Ÿç”Ÿæˆ** - åŸºäºLLMçš„ä¸šåŠ¡æ´å¯Ÿ
- **å»ºè®®æ¨è** - æ•°æ®é©±åŠ¨çš„å†³ç­–å»ºè®®

### ğŸ” æ ¹å› åˆ†æï¼ˆNEW!ï¼‰
- **æ™ºèƒ½å¼‚å¸¸æ£€æµ‹** - 3ÏƒåŸåˆ™ã€IQRå››åˆ†ä½æ³•ã€ç§»åŠ¨å¹³å‡
- **ç»´åº¦åˆ†è§£** - è´¡çŒ®åº¦åˆ†æã€å¸•ç´¯æ‰˜åˆ†æ
- **è¶‹åŠ¿åˆ†æ** - çº¿æ€§å›å½’ã€RÂ²æ‹Ÿåˆã€è½¬æŠ˜ç‚¹æ£€æµ‹
- **å› æœæ¨æ–­** - ä¸šåŠ¡è§„åˆ™å¼•æ“ã€ç½®ä¿¡åº¦é‡åŒ–
- **å¯è§†åŒ–å±•ç¤º** - å¼‚å¸¸å¡ç‰‡ã€è¶‹åŠ¿å›¾è¡¨ã€å› æœå› ç´ ã€è¡ŒåŠ¨å»ºè®®

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
- "ä¸ºä»€ä¹ˆGMVæœ€è¿‘ä¸‹é™äº†ï¼Ÿ"
- "åˆ†æDAUä¸‹é™çš„åŸå› "
- "è½¬åŒ–ç‡æ€ä¹ˆäº†"

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/JourneytoNewland/chatBI.git
cd chatBI

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv .venv
source .venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®ï¼ˆå¿…éœ€ï¼šè®¾ç½®æ™ºè°±AI API Keyï¼‰
# ZHIPUAI_API_KEY=your-api-key-here
```

### 3. å¯åŠ¨æœåŠ¡

#### æ–¹å¼Aï¼šæ¼”ç¤ºæ¨¡å¼ï¼ˆæ¨èæ–°æ‰‹ï¼‰

```bash
# ä¸€é”®å¯åŠ¨ï¼ˆå†…ç½®æ¨¡æ‹Ÿæ•°æ®ï¼‰
bash scripts/run_demo.sh
```

è®¿é—® http://localhost:8080 æŸ¥çœ‹å‰ç«¯ç•Œé¢

#### æ–¹å¼Bï¼šå®Œæ•´æ¨¡å¼ï¼ˆéœ€è¦Dockerï¼‰

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆPostgreSQL + Qdrant + Neo4jï¼‰
docker compose up -d

# åˆå§‹åŒ–æ•°æ®åº“
bash scripts/init-postgres.sh

# å¯åŠ¨APIæœåŠ¡
python run-production-server.py
```

### 4. å¯åŠ¨ç›‘æ§ï¼ˆå¯é€‰ï¼‰

```bash
# å¯åŠ¨Prometheus + Grafana
bash scripts/run-monitoring.sh

# è®¿é—®ç›‘æ§ç•Œé¢
# Prometheus: http://localhost:9090
# Grafana: http://localhost:3000 (admin/admin)
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### APIæŸ¥è¯¢ç¤ºä¾‹

```bash
# ç®€å•æŸ¥è¯¢
curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "æœ€è¿‘7å¤©GMV"}'

# ç»´åº¦åˆ†ç»„
curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "æŒ‰åœ°åŒºç»Ÿè®¡DAU"}'

# å¤æ‚æŸ¥è¯¢
curl -X POST http://localhost:8000/api/v3/query \
  -H "Content-Type: application/json" \
  -d '{"query": "æœ¬æœˆæŒ‰æ¸ é“GMVæ€»å’Œ"}'
```

### Python SDK

```python
from src.inference.enhanced_hybrid import EnhancedHybridIntentRecognizer

# åˆå§‹åŒ–è¯†åˆ«å™¨
recognizer = EnhancedHybridIntentRecognizer(llm_provider="zhipu")

# æ‰§è¡ŒæŸ¥è¯¢
result = recognizer.recognize("æœ€è¿‘7å¤©æˆäº¤é‡‘é¢")

print(f"æ ¸å¿ƒæŸ¥è¯¢: {result.final_intent.core_query}")
print(f"æ—¶é—´ç²’åº¦: {result.final_intent.time_granularity}")
print(f"ç½®ä¿¡åº¦: {result.final_intent.confidence}")
```

## ğŸ“Š æ”¯æŒçš„æŒ‡æ ‡

| åˆ†ç±» | æŒ‡æ ‡ | ç¤ºä¾‹æŸ¥è¯¢ |
|------|------|---------|
| **ç”µå•†** | GMVã€è®¢å•é‡ã€å®¢å•ä»· | "æœ€è¿‘7å¤©GMV" |
| **ç”¨æˆ·** | DAUã€MAUã€ç•™å­˜ç‡ | "æŒ‰æ¸ é“ç»Ÿè®¡DAU" |
| **æµé‡** | è½¬åŒ–ç‡ã€åŠ è´­ç‡ | "æœ¬å‘¨è½¬åŒ–ç‡" |
| **æ”¶å…¥** | ARPUã€ARPPUã€LTV | "æœ¬æœˆARPU" |
| **è´¢åŠ¡** | è¥æ”¶ã€åˆ©æ¶¦ç‡ã€ROI | "æŒ‰åœ°åŒºåˆ©æ¶¦ç‡" |

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
chatBI/
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”‚   â”œâ”€â”€ archive/              # å†å²æ–‡æ¡£å½’æ¡£
â”‚   â”œâ”€â”€ POSTGRESQL_INTEGRATION.md
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ scripts/                   # è„šæœ¬
â”‚   â”œâ”€â”€ setup/                # å®‰è£…é…ç½®è„šæœ¬
â”‚   â”œâ”€â”€ monitoring/           # ç›‘æ§è„šæœ¬
â”‚   â””â”€â”€ testing/              # æµ‹è¯•è„šæœ¬
â”‚
â”œâ”€â”€ src/                       # æºä»£ç 
â”‚   â”œâ”€â”€ api/                  # APIå±‚
â”‚   â”‚   â”œâ”€â”€ main.py           # FastAPIä¸»åº”ç”¨
â”‚   â”‚   â””â”€â”€ complete_query.py # å®Œæ•´æŸ¥è¯¢API
â”‚   â”œâ”€â”€ inference/            # æ„å›¾è¯†åˆ«
â”‚   â”‚   â”œâ”€â”€ enhanced_hybrid.py # ä¸‰å±‚æ··åˆæ¶æ„
â”‚   â”‚   â””â”€â”€ intent.py         # æ„å›¾å®šä¹‰
â”‚   â”œâ”€â”€ mql/                  # MQLå¼•æ“
â”‚   â”‚   â”œâ”€â”€ engine_v2.py      # MQLæ‰§è¡Œå¼•æ“V2
â”‚   â”‚   â”œâ”€â”€ sql_generator_v2.py # SQLç”Ÿæˆå™¨V2
â”‚   â”‚   â””â”€â”€ intelligent_interpreter.py # æ™ºèƒ½è§£è¯»
â”‚   â”œâ”€â”€ database/             # æ•°æ®åº“
â”‚   â”‚   â”œâ”€â”€ postgres_client.py # PostgreSQLå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ migrations/       # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â””â”€â”€ init_test_data.py # æµ‹è¯•æ•°æ®ç”Ÿæˆ
â”‚   â”œâ”€â”€ monitoring/           # ç›‘æ§
â”‚   â”‚   â””â”€â”€ metrics.py        # PrometheusæŒ‡æ ‡
â”‚   â””â”€â”€ config.py             # é…ç½®ç®¡ç†
â”‚
â”œâ”€â”€ frontend/                  # å‰ç«¯
â”‚   â”œâ”€â”€ index.html            # ä¸»ç•Œé¢
â”‚   â””â”€â”€ intent-visualization-v2.html # å¯è§†åŒ–ç•Œé¢
â”‚
â”œâ”€â”€ monitoring/                # ç›‘æ§é…ç½®
â”‚   â”œâ”€â”€ prometheus/           # Prometheusé…ç½®
â”‚   â””â”€â”€ grafana/              # Grafanaçœ‹æ¿
â”‚
â”œâ”€â”€ tests/                     # æµ‹è¯•
â”‚   â””â”€â”€ performance/          # æ€§èƒ½æµ‹è¯•
â”‚       â”œâ”€â”€ load_test.py      # Locustå‹åŠ›æµ‹è¯•
â”‚       â””â”€â”€ benchmark.py      # åŸºå‡†æµ‹è¯•
â”‚
â”œâ”€â”€ docker-compose.yml         # Dockerç¼–æ’
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â””â”€â”€ README.md                  # æœ¬æ–‡æ¡£
```

## ğŸ”§ é…ç½®è¯´æ˜

### æ™ºè°±AI APIï¼ˆå¿…éœ€ï¼‰

**âš ï¸ å®‰å…¨è­¦å‘Šï¼šä¸¥ç¦å°†API Keyç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼**

æ­£ç¡®é…ç½®æ–¹å¼ï¼š

```bash
# æ–¹å¼1: å‘½ä»¤è¡Œè®¾ç½®
export ZHIPUAI_API_KEY="your-api-key"

# æ–¹å¼2: .envæ–‡ä»¶
echo "ZHIPUAI_API_KEY=your-api-key" >> .env

# æ–¹å¼3: è¿è¡Œæ—¶ä¼ å…¥
ZHIPUAI_API_KEY="your-api-key" python app.py
```

é…ç½®éªŒè¯ï¼š
```bash
python -c "import os; print('âœ… é…ç½®æˆåŠŸ' if os.getenv('ZHIPUAI_API_KEY') else 'âŒ æœªé…ç½®')"
```

### æ¨¡å‹é€‰æ‹©

| æ¨¡å‹ | é€Ÿåº¦ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| glm-4-flash | å¿« | å…è´¹ | å¼€å‘æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒ |
| glm-4-plus | ä¸­ | Â¥1/1M tokens | é«˜å‡†ç¡®ç‡è¦æ±‚ |
| glm-4-0520 | æ…¢ | Â¥1/1M tokens | æœ€æ–°æ¨¡å‹ |

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| P50å»¶è¿Ÿ | <100ms | å¾…æµ‹ | - |
| P95å»¶è¿Ÿ | <300ms | å¾…æµ‹ | - |
| P99å»¶è¿Ÿ | <500ms | å¾…æµ‹ | - |
| å¹¶å‘èƒ½åŠ› | 1000 QPS | å¾…æµ‹ | - |
| æ„å›¾è¯†åˆ«å‡†ç¡®ç‡ | >95% | 95%+ | âœ… |

## ğŸ” ç›‘æ§çœ‹æ¿

å¯åŠ¨ç›‘æ§æœåŠ¡åè®¿é—®ï¼š

- **Grafana**: http://localhost:3000
  - ç”¨æˆ·å: `admin`
  - å¯†ç : `admin`
  - é¢„é…ç½®çœ‹æ¿: chatBI ç³»ç»Ÿæ¦‚è§ˆ

- **Prometheus**: http://localhost:9090
  - æŸ¥è¯¢åŸå§‹æŒ‡æ ‡
  - æŸ¥çœ‹å‘Šè­¦è§„åˆ™

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# æ€§èƒ½åŸºå‡†æµ‹è¯•
bash scripts/run-benchmark.sh

# Locustå‹åŠ›æµ‹è¯•
locust -f tests/performance/load_test.py --host=http://localhost:8000
```

### æµ‹è¯•è¦†ç›–ç‡

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=src --cov-report=html
```

## ğŸ“š æ–‡æ¡£

### æ ¸å¿ƒåŠŸèƒ½
- [æ ¹å› åˆ†æä½¿ç”¨æŒ‡å—](docs/ROOT_CAUSE_USAGE.md) - L4å±‚æ ¹å› åˆ†æå®Œæ•´æ–‡æ¡£
- [PostgreSQLé›†æˆæŒ‡å—](docs/POSTGRESQL_INTEGRATION.md) - æ•°æ®ä»“åº“æ¶æ„
- [æ„å›¾è¯†åˆ«æ–‡æ¡£](docs/intent_recognition_summary.md) - ä¸‰å±‚æ··åˆæ„å›¾è¯†åˆ«
- [MQLç³»ç»Ÿæ–‡æ¡£](docs/MQL_SYSTEM_SUMMARY.md) - MQLå¼•æ“ä¸SQLç”Ÿæˆ

### è¿ç»´ç›‘æ§
- [ç›‘æ§ç³»ç»ŸæŒ‡å—](monitoring/README.md) - Prometheus + Grafana
- [æ€§èƒ½æµ‹è¯•æŒ‡å—](tests/performance/README.md) - åŸºå‡†æµ‹è¯•ä¸å‹åŠ›æµ‹è¯•
- [å®‰å…¨æœ€ä½³å®è·µ](docs/SECURITY_BEST_PRACTICES.md) - å®‰å…¨é…ç½®ä¸å®¡è®¡

### å†å²æ–‡æ¡£
- [å†å²æ–‡æ¡£å½’æ¡£](docs/archive/) - å¼€å‘è¿‡ç¨‹æ–‡æ¡£

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'feat: Add AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ™ è‡´è°¢

- [æ™ºè°±AI](https://open.bigmodel.cn/) - æä¾›GLM-4æ¨¡å‹æ”¯æŒ
- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£åŒ–çš„Python Webæ¡†æ¶
- [PostgreSQL](https://www.postgresql.org/) - å¼ºå¤§çš„å¼€æºæ•°æ®åº“
- [Qdrant](https://qdrant.tech/) - å‘é‡æœç´¢å¼•æ“
- [Prometheus](https://prometheus.io/) - ç›‘æ§ç³»ç»Ÿ

## ğŸ“® è”ç³»æ–¹å¼

- é¡¹ç›®åœ°å€: https://github.com/JourneytoNewland/chatBI
- é—®é¢˜åé¦ˆ: [GitHub Issues](https://github.com/JourneytoNewland/chatBI/issues)

---

**å½“å‰ç‰ˆæœ¬**: v2.1
**æœ€åæ›´æ–°**: 2026-02-08
**ç»´æŠ¤è€…**: Crazygeniusï¼ˆç‹æ‹¯ï¼‰
