# 智能问数系统 - 可视化测试界面使用指南

## 🎯 功能概述

可视化测试界面提供了直观的方式来测试和理解智能问数系统的检索流程，实时展示：
- 🔍 双路召回过程（向量+图谱）
- 🧮 11维特征提取
- ⚖️ 精排打分
- ✅ 结果验证
- 🎯 最终Top-K结果

---

## 🚀 快速开始

### 1. 启动后端服务

```bash
# 确保API服务正在运行
python scripts/run_dev_server.py
```

服务将在 http://localhost:8000 启动

### 2. 打开可视化界面

直接在浏览器中打开文件：
```
frontend/index.html
```

或者在本地服务器中运行：
```bash
cd frontend
python -m http.server 8080
# 然后访问 http://localhost:8080
```

---

## 📖 界面功能说明

### 查询输入区域

**快速测试用例按钮：**
- 💰 GMV查询 - 测试精确匹配
- 👥 活跃用户 - 测试"用户"域查询
- 📊 成交额 - 测试同义词查询
- 📈 增长率 - 测试"增长"域查询

**自定义查询：**
- 输入框：支持任意自然语言查询
- 例如："最近7天的GMV"、"日活跃用户数"、"转化率"

### 参数配置

**Top-K 滑块：**
- 范围：1-20
- 默认：10
- 作用：控制返回结果数量

**相似度阈值滑块：**
- 范围：0.0-1.0
- 默认：0.0
- 作用：过滤低相似度结果

**显示详细过程：**
- 勾选框：展开/折叠中间步骤
- 默认：展开所有步骤

---

## 🎬 测试用例集

### 基础测试用例

| # | 查询 | 预期结果 | 测试目标 |
|---|------|---------|---------|
| 1 | GMV | GMV在Top-1 | 精确匹配 |
| 2 | 成交总额 | GMV在Top-3 | 同义词查询 |
| 3 | 交易额 | GMV在Top-3 | 部分同义词 |
| 4 | DAU | DAU在Top-1 | 用户域查询 |
| 5 | 日活 | DAU在Top-1 | 同义缩写 |

### 复杂测试用例

| # | 查询 | 预期结果 | 测试目标 |
|---|------|---------|---------|
| 6 | 最近7天的活跃用户数 | DAU, MAU | 时间+域 |
| 7 | 用户增长指标 | DAU, MAU, 增长率 | 域内聚合 |
| 8 | 收入相关指标 | GMV, ARPU, LTV | 多域召回 |
| 9 | 转化率和成交额 | 转化率, GMV | 混合域 |
| 10 | 实时用户数据 | DAU (可能警告) | 验证器测试 |

### 边界测试用例

| # | 查询 | 预期结果 | 测试目标 |
|---|------|---------|---------|
| 11 | 空 | 400错误 | 输入验证 |
| 12 | 非常长的查询 | 正常响应 | 长文本处理 |
| 13 | 不存在的指标 | 空列表 | 召回失败 |
| 14 | 特殊字符 | 正常响应 | 特殊字符处理 |

---

## 📊 结果展示说明

### 步骤1: 双路召回

**向量召回 (Qdrant):**
- 显示Top-5召回结果
- 显示向量相似度分数（x0.7权重）

**图谱召回 (Neo4j):**
- 显示Top-5召回结果
- 显示图谱分数（固定基础分+相关性）

**融合结果:**
- 去重后的指标列表
- 以网格形式展示

### 步骤2: 特征提取

展示每个候选指标的11维特征：
- 🔵 向量相似度 (30%)
- 🟢 图谱分数 (15%)
- 🟣 精确匹配 (15%)
- 🟠 查询覆盖 (8%)
- 🩷 文本相关 (5%)
- ... 其他特征

每个特征条显示：
- 特征名称和权重
- 实际特征值
- 进度条可视化

### 步骤3: 精排打分

显示：
- 特征权重配置
- 排序后的候选列表
- 最终打分分数

### 步骤4: 结果验证

显示4个验证器的检查结果：
- ✅ 维度兼容性
- ✅ 时间粒度
- ⚠️ 数据新鲜度
- ✅ 权限验证

颜色编码：
- 🟢 通过
- 🟡 警告
- 🔴 失败

### 最终结果

展示Top-K排序结果：
- 排名
- 指标名称
- 编码
- 描述
- 相似度分数
- 同义词

---

## 🧪 交互式测试流程

### 典型测试流程示例

**测试目标：验证双路召回融合**

1. **输入查询**：`"GMV"`

2. **观察向量召回**：
   - 应该看到 GMV 在Top-1
   - 向量分数应该接近 1.0

3. **观察图谱召回**：
   - 可能看到相关指标（如交易额、成交金额）
   - 基于关系路径挖掘

4. **观察特征提取**：
   - 精确匹配特征应该为1.0（完全匹配）
   - 向量相似度应该较高

5. **观察验证结果**：
   - 所有验证器应该通过（绿色✅）
   - 可能有时间粒度警告

6. **验证最终结果**：
   - GMV 应该在Top-1
   - 分数应该 > 0.9

---

## 🎨 界面定制

### 修改主题色

在 `<style>` 标签中修改颜色：

```css
/* 主色调 */
.bg-blue-600 { background-color: #your-color; }

/* 强调色 */
.text-purple-600 { color: #your-color; }
```

### 调整特征权重

在 `displayFeatures()` 函数中修改：

```javascript
const features = [
    { name: '向量相似度', weight: 0.30, color: 'blue' },
    { name: '图谱分数', weight: 0.15, color: 'green' },
    // ... 修改权重值
];
```

---

## 🔍 调试技巧

### 查看API原始响应

打开浏览器开发者工具（F12），切换到Console标签，执行：

```javascript
// 查看最后一次API响应
window.lastResponse = data;
console.log(data);
```

### 模拟数据测试

在浏览器Console中执行：

```javascript
// 模拟测试数据
const mockData = {
    query: "GMV",
    candidates: [
        {
            metric_id: "m001",
            name: "GMV",
            code: "gmv",
            description: "成交总额",
            domain: "电商",
            score: 0.95,
            synonyms: ["成交金额", "交易额"],
            formula: "SUM(order_amount)"
        }
    ],
    total: 1,
    execution_time: 485.32
};

displayResults(mockData, 500);
```

---

## 📊 性能基准

### 预期性能指标

- 向量召回：< 200ms
- 图谱召回：< 150ms
- 特征提取：< 100ms
- 精排排序：< 50ms
- 结果验证：< 50ms
- **总耗时**：< 600ms

### 性能优化建议

1. **减少Top-K**：设置较小的top_k值（如5）
2. **提高阈值**：设置score_threshold > 0.5
3. **关闭详细视图**：取消勾选"显示详细过程"

---

## 🐛 常见问题

### Q1: 点击"检索"没有反应

**A:** 检查后端服务是否启动
```bash
curl http://localhost:8000/health
```

### Q2: 显示"检索失败"

**A:**
1. 确认Qdrant和Neo4j正在运行
2. 检查.env配置是否正确
3. 查看浏览器Console的错误信息

### Q3: 界面显示但数据为空

**A:**
1. 打开浏览器开发者工具（F12）
2. 切换到Network标签
3. 查看API请求和响应
4. 检查是否有CORS错误

### Q4: 特征条显示不正确

**A:** 这是模拟数据，实际应用中会连接真实API获取真实特征值

---

## 📈 进阶使用

### 保存测试结果

使用浏览器的"截图"功能或开发者工具的"记录"功能保存测试过程。

### 批量测试

在Console中执行：

```javascript
// 批量测试多个查询
const queries = ['GMV', 'DAU', '转化率', 'ARPU'];

queries.forEach(q => {
    document.getElementById('queryInput').value = q;
    executeSearch();
    // 等待2秒后执行下一个
    await new Promise(resolve => setTimeout(resolve, 2000));
});
```

### 导出测试报告

使用浏览器的打印功能（Ctrl+P）保存为PDF作为测试报告。

---

## 🎓 教学用途

这个可视化界面非常适合：

1. **演示系统功能**：向利益相关者展示系统能力
2. **教学培训**：帮助新成员理解检索流程
3. **调试优化**：直观看到每步的中间结果
4. **参数调优**：调整Top-K和阈值观察效果
5. **A/B测试**：比较不同查询策略的效果

---

## 📝 更新日志

### v1.0 (2026-02-04)
- ✅ 基础界面框架
- ✅ 双路召回展示
- ✅ 特征提取可视化
- ✅ 精排结果展示
- ✅ 验证结果展示
- ✅ 快速测试用例
- ✅ 参数配置
- ✅ 性能统计

---

## 👥 维护者

Claude Sonnet 4.5

**最后更新**: 2026-02-04
