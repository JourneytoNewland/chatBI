<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿æ¥è¯Šæ–­</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #48bb78; font-weight: bold; }
        .error { color: #f56565; font-weight: bold; }
        .info { color: #4299e1; }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover { background: #5a67d8; }
        pre {
            background: #f7fafc;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ç³»ç»Ÿè¿æ¥è¯Šæ–­</h1>

    <div class="test-card">
        <h3>1. å‰ç«¯æœåŠ¡æµ‹è¯•</h3>
        <p id="frontendTest">æµ‹è¯•ä¸­...</p>
    </div>

    <div class="test-card">
        <h3>2. åç«¯APIæµ‹è¯•</h3>
        <p id="backendTest">æµ‹è¯•ä¸­...</p>
        <button onclick="testBackend()">é‡æ–°æµ‹è¯•</button>
        <pre id="backendResult"></pre>
    </div>

    <div class="test-card">
        <h3>3. å®Œæ•´æŸ¥è¯¢æµ‹è¯•</h3>
        <button onclick="testFullQuery()">æµ‹è¯•æŸ¥è¯¢</button>
        <pre id="queryResult"></pre>
    </div>

    <div class="test-card">
        <h3>4. è§£å†³æ–¹æ¡ˆ</h3>
        <div class="info">
            <p><strong>å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œè¯·å°è¯•ï¼š</strong></p>
            <ol>
                <li>å¼ºåˆ¶åˆ·æ–°é¡µé¢ï¼šCtrl+Shift+R (Windows) æˆ– Cmd+Shift+R (Mac)</li>
                <li>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</li>
                <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰æŸ¥çœ‹Consoleé”™è¯¯ä¿¡æ¯</li>
                <li>ç¡®è®¤åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼š<code>ps aux | grep uvicorn</code></li>
            </ol>
        </div>
    </div>

    <script>
        // æµ‹è¯•å‰ç«¯æœåŠ¡
        document.getElementById('frontendTest').innerHTML =
            '<span class="success">âœ… å‰ç«¯æœåŠ¡æ­£å¸¸</span> (å½“å‰é¡µé¢åŠ è½½æˆåŠŸ)';

        // æµ‹è¯•åç«¯æœåŠ¡
        async function testBackend() {
            const resultEl = document.getElementById('backendResult');
            const testEl = document.getElementById('backendTest');

            try {
                resultEl.textContent = 'æ­£åœ¨è¿æ¥ http://localhost:8000...';

                const response = await fetch('http://localhost:8000/');

                if (response.ok) {
                    testEl.innerHTML = '<span class="success">âœ… åç«¯æœåŠ¡æ­£å¸¸</span>';
                    resultEl.textContent = 'è¿æ¥æˆåŠŸï¼çŠ¶æ€ç : ' + response.status;
                } else {
                    testEl.innerHTML = '<span class="error">âŒ åç«¯å“åº”å¼‚å¸¸</span>';
                    resultEl.textContent = 'çŠ¶æ€ç : ' + response.status;
                }
            } catch (error) {
                testEl.innerHTML = '<span class="error">âŒ æ— æ³•è¿æ¥åç«¯</span>';
                resultEl.textContent = 'é”™è¯¯: ' + error.message + '\n\nå¯èƒ½åŸå› ï¼š\n1. åç«¯æœåŠ¡æœªå¯åŠ¨\n2. ç«¯å£8000è¢«å ç”¨\n3. é˜²ç«å¢™é˜»æ­¢è¿æ¥';
            }
        }

        // æµ‹è¯•å®Œæ•´æŸ¥è¯¢
        async function testFullQuery() {
            const resultEl = document.getElementById('queryResult');

            try {
                resultEl.textContent = 'æ­£åœ¨å‘é€æŸ¥è¯¢è¯·æ±‚...';

                const response = await fetch('http://localhost:8000/api/v2/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query: 'æœ€è¿‘7å¤©çš„GMV' })
                });

                const data = await response.json();

                if (data.intent) {
                    resultEl.textContent =
                        'âœ… æŸ¥è¯¢æˆåŠŸï¼\n\n' +
                        JSON.stringify(data, null, 2);
                } else {
                    resultEl.textContent =
                        'âš ï¸ å“åº”æ ¼å¼å¼‚å¸¸\n\n' +
                        JSON.stringify(data, null, 2);
                }
            } catch (error) {
                resultEl.textContent =
                    'âŒ æŸ¥è¯¢å¤±è´¥\n\n' +
                    'é”™è¯¯: ' + error.message;
            }
        }

        // è‡ªåŠ¨æµ‹è¯•åç«¯
        testBackend();
    </script>
</body>
</html>
